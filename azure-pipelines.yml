# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

# trigger:
# - master

# stages:
#   - stage: Build
#     pool:
#       vmImage: ubuntu-latest
#     variables:
#       version: $(nextRelease)

#     jobs:
#     - job:
#       displayName: "Configuring Node"
#       workspace:
#         clean: all
#       steps:
#         - task: NodeTool@0
#           inputs:
#             versionSpec: "16.x"
#           displayName: "Install Node.js"
          
#         - task: Npm@1
#           inputs:
#             command: "install"
#           displayName: "Npm Install"
#         - task: CmdLine@2
#           inputs:
#             script: 'ls .'
#             workingDirectory: '.'
#         - script: >
#             npx semantic-release
#           env: { GH_TOKEN: $(secrets.azure-artifacts) }
#           displayName: "Semantic release"


jobs:
- job: Build
  pool:
    vmImage: windows-latest

  steps:
  - task: Npm@1
    inputs:
      command: "install"
    displayName: "Npm Install"

  - script: >
      npx -p semantic-release
      -p semantic-release-ado
      semantic-release
      
    env: { GH_TOKEN: $(GIT_ACCESS_TOKEN) }
    displayName: 'Semantic release'

  - script: echo $(nextRelease)
    displayName: 'Show next version'

  - task: Npm@0
    input:
      command: npm version $(nextRelease)

  - task: Npm@1
    inputs:
      command: 'publish'
      publishRegistry: 'useFeed'
      publishFeed: '1ebebcd4-a114-4cf3-957d-2a9c5f11c58d/628b9ae3-6fce-4079-a602-4458942931c5'